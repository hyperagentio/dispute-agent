services:
  llm:
    image: "docker.io/ollama/ollama"
    volumes:
      - ollama_data:/root/.ollama
    entrypoint: ["/usr/bin/bash", "-c", "/bin/ollama serve & sleep 5; ollama pull qwen2:0.5b; wait"]

  app:
    build: ./app
    platform: linux/amd64
    ports:
      - "4021:4021"
    volumes:
      - /run/rofl-appd.sock:/run/rofl-appd.sock
    environment:
      - ENDPOINT_URL=${ENDPOINT_URL:-http://localhost:4021/verify}
      - OLLAMA_HOST=http://llm:11434
      - AGENT0_CHAIN_ID=${AGENT0_CHAIN_ID:-84532}
      - AGENT0_RPC_URL=${AGENT0_RPC_URL}
      - AGENT0_PRIVATE_KEY=${AGENT0_PRIVATE_KEY}
      - AGENT0_IPFS_PROVIDER=${AGENT0_IPFS_PROVIDER:-pinata}
      - AGENT0_PINATA_JWT=${AGENT0_PINATA_JWT}
      - AGENT_NAME=${AGENT_NAME:-Verifier Agent}
      - AGENT_DESCRIPTION=${AGENT_DESCRIPTION:-Verifier agent for dispute resolution running in TEE}
      - AGENT_IMAGE=${AGENT_IMAGE:-http://localhost:4021/logo.png}
      - AGENT_WALLET_ADDRESS=${AGENT_WALLET_ADDRESS}
      - ENVIRONMENT=${ENVIRONMENT:-development}
    depends_on:
      - llm

volumes:
  ollama_data:
