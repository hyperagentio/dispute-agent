# Verifier Agent - Oasis ROFL Service

A confidential AI microservice that verifies jobs inside a verifiable TEE.

- **ðŸ”’ Private**: Jobs processed inside a confidential Oasis ROFL container using Ollama (qwen2:0.5b)
- **ðŸ” Secure**: Uses aTLS (Attested TLS) with end-to-end TLS authentication from the TEE
- **âœ… Verifiable**: Remote attestation proves the exact code running in the TEE
- **ðŸ” Signed**: All responses cryptographically signed with TEE-generated SECP256K1 keys

**Tech Stack**
- Python FastAPI backend
- Ollama (Qwen2 0.5B model)
- Oasis ROFL keymanager for TEE-based cryptographic signing
- Runs in an Oasis ROFL TEE on the Oasis Network

## Testing Locally

```bash
docker compose up
```

The test client (in the `test/` folder) automatically requests the verification via HTTP.

```bash
cd test
uv sync

# Configure API URL
echo "API_URL=http://localhost:4021" > .env

# Run the test (uses test_document.txt by default)
uv run python test_client.py

# Or test with your own job data
uv run python test_client.py /path/to/your/job_data.txt
```

**Example output:**

```
âœ… Job created (took 1.66s)

â³ Polling for result...
   âœ… Completed after ~44s

ðŸ“„ Summary:
   The document discusses the technology zkTLS that combines two cryptographic
   approaches: TLS providing encryption and authentication for secure data
   transmission in HTTPS while zero-knowledge proofs allow one party to prove
   knowledge of information without revealing it...

ðŸ“Š Stats:
   Word count: 304
   Reading time: 1 minute
```

Testing with [zkTLS article](https://oasis.net/blog/zktls-blockchain-security) (2,362 characters).

## TEE-Attested Response Signing

All API responses are cryptographically signed using SECP256K1 keys generated inside the Oasis ROFL TEE, providing cryptographic proof that responses originated from the attested service.

**How it works:**
1. On startup, the service generates a SECP256K1 key pair using Oasis ROFL's keymanager
2. The public key is registered in Oasis ROFL metadata as `rofl_signing_public_key`
3. Each response is signed with a recoverable ECDSA signature over canonical JSON
4. Clients can verify signatures by recovering the public key and comparing to the registered key

**Signed response format:**
```json
{
  "status": "completed",
  "summary": "...",
  "timestamp": 1730000000,
  "signature": "df9528e21e543b31a6b909d66002f974...",
  "public_key": "03e1e2206b206770bb69feb6f37ec091..."
}
```

**Configuration:**
```bash
ENVIRONMENT=production      # Uses Oasis ROFL keymanager for signing
ENVIRONMENT=development     # Signing disabled
DEBUG_SIGNING=true         # Use mock keys for testing
```

In production, the signing key is generated by Oasis ROFL's secure keymanager and never leaves the TEE. The public key can be verified against the on-chain attested state in the [Oasis ROFL registry](https://github.com/ptrus/rofl-registry).


## Deploy Your Own Service

**Ready to build your own paid AI service?** Follow these steps to deploy on Oasis:

### 1. Clone the Repository

```bash
git clone https://github.com/hyperagentio/dispute-agent
cd dispute-agent
```

### 2. Reset ROFL Manifest

Clear existing deployment configuration using [oasis-cli](https://github.com/oasisprotocol/cli):

```bash
oasis rofl init --reset
```

### 3. Customize Your Service

Modify the endpoint implementation in `app/main.py` to create your own service:

```python
@app.post("/verify")
async def verify_job(request: JobRequest) -> Dict[str, Any]:
    # Your custom service logic here
    # Example: job verification, data analysis, API access, etc.
    ...
```

Update the API configuration as needed.

### 4. Deploy to ROFL

Follow the [ROFL deployment guide](https://docs.oasis.io/build/tools/cli/rofl) to deploy your service:

```bash
# Build the container
docker compose build

# Push to registry (if needed)
docker tag your-image:latest your-registry/your-app:latest
docker push your-registry/your-app:latest

# Deploy using oasis-cli
oasis rofl deploy
```

Your service will be deployed with verifiable code execution!

## Learn More

- [Oasis ROFL](https://docs.oasis.io/rofl) - Runtime Off-chain Logic documentation
- [Ollama](https://ollama.com) - Run large language models locally

## License

This is example code for demonstration purposes.
